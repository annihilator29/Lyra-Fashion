<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>2.1</storyId>
    <title>Product Data Model &amp; Seeding</title>
    <status>drafted</status>
    <generatedAt>2025-11-28</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/2-1-product-data-model-seeding.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Backend Developer</asA>
    <iWant>to define the product data schema and seed the database with initial inventory</iWant>
    <soThat>the frontend has realistic data to display</soThat>
    <tasks>
- [ ] Finalize `products` table schema. (AC: 1)
  - [ ] Ensure columns: `id`, `name`, `slug`, `price`, `description`, `category`, `images`, `transparency_data`, `created_at`.
  - [ ] Add indexes on `category` and `slug` for performance.
- [ ] Create Seeding Script. (AC: 2)
  - [ ] Create `supabase/seed.sql` or a TypeScript script `scripts/seed.ts`.
  - [ ] Define mock data for 20+ items across categories (Dresses, Tops, Pants).
  - [ ] Include realistic transparency cost breakdowns.
- [ ] Execute Seeding. (AC: 3)
  - [ ] Run the seed script against the local/dev database.
  - [ ] Verify data integrity via Supabase Dashboard or SQL query.
- [ ] Update Types.
  - [ ] Regenerate `database.types.ts` if schema changed.
    </tasks>
  </story>

  <acceptanceCriteria>
1. `products` table schema is finalized in Supabase (including JSONB fields).
2. A seeding script (`seed.ts` or `seed.sql`) is created.
3. Database is populated with at least 20 realistic product items.
4. Each product has: name, slug, price, description, category, images (placeholders or real), and transparency_data.
5. `transparency_data` JSON structure is validated (fabric, labor, transport, markup).
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/tech-spec-epic-2.md</path>
        <title>Technical Specification: Epic 2</title>
        <section>3.1 Data Models</section>
        <snippet>Table: products. Columns: id, name, slug, description, price, images, category, transparency_data (jsonb).</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Technical Specification: Epic 1</title>
        <section>2.2 Data Models</section>
        <snippet>Initial schema definition.</snippet>
      </doc>
    </docs>
    <code>
      <!-- No existing code yet -->
    </code>
    <dependencies>
      <ecosystem name="Node.js">
        <package name="@supabase/supabase-js" />
        <package name="ts-node" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    - Use Supabase
    - Use JSONB for transparency data
    - Images must be valid URLs
  </constraints>
  <interfaces>
    <!-- Database Schema is the interface -->
  </interfaces>
  <tests>
    <standards>
      Data Integrity Check: Verify row count and column values.
    </standards>
    <locations>
      Supabase Dashboard / SQL Editor
    </locations>
    <ideas>
      - SELECT count(*) FROM products;
      - SELECT * FROM products LIMIT 1;
    </ideas>
  </tests>
</story-context>
