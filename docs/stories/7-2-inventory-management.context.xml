<story_context>
  <story_meta>
    <id>7.2</id>
    <key>7-2-inventory-management</key>
    <title>Inventory Management</title>
    <status>ready-for-dev</status>
    <user_story>
      <as_a>Admin</as_a>
      <i_want>manage product inventory levels</i_want>
      <so_that>I can ensure stock accuracy and prevent overselling</so_that>
    </user_story>
  </story_meta>

  <requirements>
    <acceptance_criteria>
      <criterion id="1">Admin can view a paginated list of all products and their variants with current stock levels.</criterion>
      <criterion id="2">Admin can manually update the stock quantity for a specific product variant.</criterion>
      <criterion id="3">Items with stock below the low stock threshold (default 5) are visually highlighted (e.g., red badge).</criterion>
      <criterion id="4">Stock updates are reflected immediately in the admin view and customer-facing product pages.</criterion>
      <criterion id="5">Only users with 'admin' role can access the inventory management page and perform updates.</criterion>
    </acceptance_criteria>

    <tasks>
      <task id="1">Database & Service Layer (AC: 1, 2, 4)</task>
      <task id="2">Inventory List UI (AC: 1, 3, 5)</task>
      <task id="3">Stock Update Interaction (AC: 2, 4)</task>
      <task id="4">E2E Tests (AC: 1-5)</task>
    </tasks>
  </requirements>

  <artifacts>
    <docs>
      <doc>
        <path>docs/tech-spec-epic-7.md</path>
        <title>Epic Technical Specification: Admin Dashboard & Inventory</title>
        <section>Detailed Design</section>
        <snippet>Defines InventoryService, inventory table schema, and updateInventory server action.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Epic 7: Operations & Admin</section>
        <snippet>Story 7.2: Inventory Management requirements.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Data Architecture</section>
        <snippet>Defines inventory table and relationship to products.</snippet>
      </doc>
    </docs>

    <code>
      <!-- Planned Code -->
      <item>
        <path>src/services/admin/inventory-service.ts</path>
        <kind>service</kind>
        <symbol>InventoryService</symbol>
        <reason>Service to handle inventory logic (Planned)</reason>
      </item>
      <item>
        <path>src/app/admin/inventory/page.tsx</path>
        <kind>page</kind>
        <symbol>InventoryPage</symbol>
        <reason>Main inventory management page (Planned)</reason>
      </item>
      
      <!-- Existing Context -->
      <item>
        <path>src/app/admin/layout.tsx</path>
        <kind>layout</kind>
        <symbol>AdminLayout</symbol>
        <reason>Existing admin layout to host the inventory page</reason>
      </item>
    </code>

    <dependencies>
      <package>next</package>
      <package>@supabase/ssr</package>
      <package>tailwindcss</package>
      <package>lucide-react</package>
      <package>@tanstack/react-table</package>
    </dependencies>
  </artifacts>

  <tests>
    <standards>
      Use Playwright for E2E testing. Test admin access control and inventory persistence.
    </standards>
    <ideas>
      <idea id="1">Verify non-admin cannot access /admin/inventory</idea>
      <idea id="2">Update stock for a product and verify it persists in DB</idea>
      <idea id="3">Verify low stock visual indicator appears when quantity < threshold</idea>
    </ideas>
  </tests>

  <constraints>
    <constraint>Use Server Actions for data mutations.</constraint>
    <constraint>Ensure RBAC checks are enforced on both Page and Action level.</constraint>
    <constraint>Use optimistic updates for better UX.</constraint>
  </constraints>
</story_context>
