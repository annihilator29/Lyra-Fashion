<story-context id="5-1-shopping-cart-management" v="1.0">
  <metadata>
    <epicId>5</epicId>
    <storyId>5.1</storyId>
    <title>Shopping Cart Management</title>
    <status>drafted</status>
    <generatedAt>2025-11-28</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/5-1-shopping-cart-management.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Customer</asA>
    <iWant>manage my shopping cart</iWant>
    <soThat>I can review items before checkout</soThat>
    <tasks>
- [ ] Task 1: Setup Zustand Store (AC: 1, 3, 4, 5)
  - [ ] Install `zustand`
  - [ ] Create `src/lib/store/cart.ts`
  - [ ] Implement `addItem`, `removeItem`, `updateQuantity`, `clearCart` actions
  - [ ] Configure persistence with `persist` middleware
- [ ] Task 2: Create Add to Cart Component (AC: 1)
  - [ ] Create `AddToCartButton` component
  - [ ] Connect to store's `addItem`
  - [ ] Handle variant selection (Size/Color)
- [ ] Task 3: Create Cart Page (AC: 2, 3, 4)
  - [ ] Create `src/app/(shop)/cart/page.tsx`
  - [ ] Display cart items table/list
  - [ ] Implement quantity controls (+/-)
  - [ ] Implement remove button
  - [ ] Display subtotal and total
- [ ] Task 4: Update Header Cart Icon (AC: 6)
  - [ ] Connect Header component to store
  - [ ] Display badge with item count (handle hydration mismatch)
- [ ] Task 5: Unit Tests (AC: 1-5)
  - [ ] Test Zustand store logic (add, remove, update, persist)
    </tasks>
  </story>

  <acceptanceCriteria>
1. User can add items to the cart from the Product Detail Page.
2. User can view the cart page with a list of items, quantities, and total price.
3. User can increase or decrease the quantity of an item.
4. User can remove an item from the cart.
5. Cart state persists across page reloads (using local storage).
6. Cart icon in the header shows the current item count.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/tech-spec-epic-5.md</path>
        <title>Epic 5 Tech Spec</title>
        <section>Detailed Design</section>
        <snippet>Defines CartStore using Zustand and persistence requirements.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>State Management</section>
        <snippet>Zustand chosen for lightweight cart management.</snippet>
      </doc>
    </docs>
    <code>
      <!-- No existing cart code yet -->
    </code>
    <dependencies>
      <dep>zustand</dep>
      <dep>lucide-react</dep>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Use Zustand for state management.</constraint>
    <constraint>Persist state to localStorage.</constraint>
    <constraint>Handle hydration mismatches carefully.</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>useCartStore</name>
      <kind>Zustand Hook</kind>
      <signature>useCartStore((state) => state.items)</signature>
      <path>src/lib/store/cart.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Unit tests for store logic using Jest/Vitest (if available) or manual verification via UI.</standards>
    <locations>tests/unit</locations>
    <ideas>
      <idea>Test adding item increases count.</idea>
      <idea>Test removing item decreases count.</idea>
      <idea>Test persistence survives reload.</idea>
    </ideas>
  </tests>
</story-context>
